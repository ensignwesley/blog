<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Status — Reports from the Frontline</title>
  <style>
    :root {
      --bg:      #0a0e12;
      --surface: #111820;
      --border:  #1e2a36;
      --teal:    #2dd4bf;
      --text:    #c8d6e5;
      --muted:   #5a7a8a;
      --green:   #22c55e;
      --red:     #ef4444;
      --amber:   #f59e0b;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background:  var(--bg);
      color:       var(--text);
      font-family: 'Courier New', Courier, monospace;
      min-height:  100vh;
      padding:     2rem 1rem;
    }

    .container {
      max-width: 680px;
      margin:    0 auto;
    }

    header {
      border-bottom: 1px solid var(--border);
      padding-bottom: 1.5rem;
      margin-bottom:  2rem;
    }

    .site-name {
      color:           var(--teal);
      font-size:       0.75rem;
      letter-spacing:  0.15em;
      text-transform:  uppercase;
      text-decoration: none;
      margin-bottom:   0.6rem;
      display:         block;
    }

    h1 {
      font-size:     1.8rem;
      color:         var(--teal);
      margin-bottom: 0.4rem;
    }

    .subtitle {
      color:     var(--muted);
      font-size: 0.82rem;
    }

    .overall {
      display:      inline-flex;
      align-items:  center;
      gap:          0.5rem;
      padding:      0.35rem 0.75rem;
      border-radius: 3px;
      font-size:    0.78rem;
      font-weight:  bold;
      letter-spacing: 0.1em;
      margin-top:   1rem;
    }

    .overall.all-up  { background: rgba(34,197,94,0.08);  border: 1px solid var(--green); color: var(--green); }
    .overall.has-down { background: rgba(239,68,68,0.08); border: 1px solid var(--red);   color: var(--red);   }

    .dot { width: 7px; height: 7px; border-radius: 50%; background: currentColor; }

    .services { display: flex; flex-direction: column; gap: 0.75rem; }

    .card {
      background:    var(--surface);
      border:        1px solid var(--border);
      border-radius: 4px;
      padding:       1.1rem 1.4rem;
      display:       flex;
      align-items:   center;
      gap:           1rem;
      transition:    border-color 0.15s;
    }

    .card:hover { border-color: var(--teal); }

    .card-info { flex: 1; min-width: 0; }

    .card-name {
      font-size:     0.95rem;
      color:         var(--teal);
      margin-bottom: 0.2rem;
    }

    .card-name a { color: inherit; text-decoration: none; }
    .card-name a:hover { text-decoration: underline; }

    .card-desc { font-size: 0.78rem; color: var(--muted); }

    .card-status { text-align: right; flex-shrink: 0; }

    .badge {
      display:        inline-flex;
      align-items:    center;
      gap:            0.3rem;
      padding:        0.22rem 0.55rem;
      border-radius:  3px;
      font-size:      0.72rem;
      font-weight:    bold;
      letter-spacing: 0.08em;
      margin-bottom:  0.35rem;
    }

    .badge.up   { background: rgba(34,197,94,0.08);  border: 1px solid var(--green); color: var(--green); }
    .badge.down { background: rgba(239,68,68,0.08);  border: 1px solid var(--red);   color: var(--red);   }

    .rtime {
      font-size: 0.72rem;
      color:     var(--muted);
    }

    .rtime .fast { color: var(--green); }
    .rtime .ok   { color: var(--amber); }
    .rtime .slow { color: var(--red);   }

    .loading {
      text-align: center;
      padding:    3rem;
      color:      var(--muted);
      font-size:  0.85rem;
    }

    .meta {
      margin-top:   1.5rem;
      padding-top:  1rem;
      border-top:   1px solid var(--border);
      font-size:    0.72rem;
      color:        var(--muted);
      text-align:   center;
    }

    footer {
      margin-top:   3rem;
      border-top:   1px solid var(--border);
      padding-top:  1.5rem;
      text-align:   center;
      font-size:    0.75rem;
      color:        var(--muted);
    }

    footer a { color: var(--teal); text-decoration: none; }
    footer a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <a href="/" class="site-name">☠ Reports from the Frontline</a>
      <h1>System Status</h1>
      <p class="subtitle">Live health of all active services. Updated every 5 minutes.</p>
      <div id="overall" class="overall" style="display:none"></div>
    </header>

    <div id="services" class="services">
      <div class="loading">Loading status data…</div>
    </div>

    <div id="meta" class="meta"></div>

    <footer>
      <a href="/">← Blog</a> &nbsp;·&nbsp;
      <a href="/drop">Dead Drop</a> &nbsp;·&nbsp;
      <a href="/chat">DEAD//CHAT</a> &nbsp;·&nbsp;
      <a href="/projects/">Projects</a>
    </footer>
  </div>

  <script>
    function ago(iso) {
      const diff = Math.floor((Date.now() - new Date(iso).getTime()) / 1000);
      if (diff < 60)   return diff + 's ago';
      if (diff < 3600) return Math.floor(diff / 60) + 'm ago';
      return Math.floor(diff / 3600) + 'h ago';
    }

    function rtClass(ms) {
      if (ms === null) return '';
      if (ms < 100) return 'fast';
      if (ms < 500) return 'ok';
      return 'slow';
    }

    async function load() {
      try {
        const r    = await fetch('/status/data.json?_=' + Date.now());
        if (!r.ok) throw new Error(r.status);
        const data = await r.json();

        // Overall badge
        const ov = document.getElementById('overall');
        ov.style.display = 'inline-flex';
        if (data.all_up) {
          ov.className = 'overall all-up';
          ov.innerHTML = '<span class="dot"></span> ALL SYSTEMS OPERATIONAL';
        } else {
          ov.className = 'overall has-down';
          ov.innerHTML = '<span class="dot"></span> DEGRADED';
        }

        // Cards
        document.getElementById('services').innerHTML = data.services.map(s => {
          const cl   = s.up ? 'up' : 'down';
          const lbl  = s.up ? 'OPERATIONAL' : 'DOWN';
          const ms   = s.response_ms !== null
            ? `<span class="${rtClass(s.response_ms)}">${s.response_ms}ms</span>`
            : '<span>—</span>';
          const name = s.link
            ? `<a href="${s.link}" target="_blank" rel="noopener">${s.name}</a>`
            : s.name;
          return `
            <div class="card">
              <div class="card-info">
                <div class="card-name">${name}</div>
                <div class="card-desc">${s.description}</div>
              </div>
              <div class="card-status">
                <div class="badge ${cl}"><span class="dot"></span>${lbl}</div>
                <div class="rtime">${ms}</div>
              </div>
            </div>`;
        }).join('');

        // Meta
        document.getElementById('meta').textContent =
          'Last checked: ' + ago(data.generated_at) +
          ' · ' + new Date(data.generated_at).toUTCString();

      } catch (e) {
        document.getElementById('services').innerHTML =
          '<div class="loading">Status data unavailable — try refreshing.</div>';
      }
    }

    load();
  </script>
</body>
</html>
